==============
虚拟机和容器
==============

虚拟机
=======

概述
-------
虚拟机通俗来讲就是模拟一个完整计算机的一套软件，每个虚拟机都有自己的操作系统和应用程序，同时模拟
出自己的整套硬件包括CPU、内存、图形加速器和存储等。一台物理计算机上通常可以运行多个虚拟机，每个虚
拟机的用户都认为自己独占了操作系统的全部资源。

使用虚拟机通常有以下优点：

- **提高资源使用率，降低硬件成本：** 一台物理计算机上可以同时运行多个虚拟机，虚拟机间相互隔离，
  不同的虚拟机可以为不同的用户服务，提高了单台设备的使用率，同时用户想使用不同操作系统时不用购买
  新的计算机，降低了用户购买设备的成本；

- **安全性和可快速恢复：**  虚拟机其实一个文件，可以通过外部程序扫描，以确定是否存在恶意软件。在
  虚拟机运行过程中可以在任意时间生成对应的快照，通过快照就可以恢复相应时间点的运行状态，保障了故
  障后快速恢复；

- **灵活性和可移植：** 虚拟机支持快速安装多种操作系统，并且可克隆已安装的虚拟机，支持开发人员和
  测试人员在不同硬件环境中快速重新部署，也支持随时创建新环境以处理新任务。

使用虚拟机通常有以下缺点：

- 在虚拟机上运行某些特殊的应用时性能会低于直接在原生硬件上运行。

工作原理
----------
虚拟机是由虚拟化技术支撑实现的，虚拟化技术允许多个虚拟环境共享一个系统。 **Hypervisor（虚拟机
监控程序）** 实现了虚拟化技术，可有效分隔物理资源并将这些资源分配给不同虚拟环境使用。

虚拟机监控程序可能位于操作系统之上，也可以直接安装在硬件上，根据虚拟机监控程序位置的不同，可分为：
Type-1和Type-2两类虚拟机监控程序。运行了虚拟机监控程序的设备称为主机，而使用其资源的虚拟机则被
称为客户机。

Type-1类
**********
这类虚拟机监控程序也称为本机或裸机虚拟机监控程序，直接在硬件上运行管理客户机。它可取代主机操作系
统，虚拟机监控程序直接将虚拟机资源调度到硬件上。这种类型的虚拟机监控程序常用于企业数据中心或其他
基于服务器的环境。

KVM、Microsoft Hyper-V和VMware vSphere都是典型的Type-1类虚拟机监控程序。KVM已于2007年合
并到Linux内核中，因此使用较新版本的Linux，可以直接使用KVM。

Type-2类
**********
这类虚拟机监控程序也称为托管虚拟机监控程序，它在传统操作系统上以应用的形式运行。其工作原理是从主
机操作系统中将客户机操作系统抽象出来。虚拟机的运行时的资源被虚拟机监控程序调度分配到主机操作系统
上，然后由主机操作系统传递给硬件执行。这种类型的虚拟机监控程序更适合希望在私人电脑上运行多个操作
系统的个人用户。

VMware Workstation和Oracle VirtualBox就是典型的Type-2类虚拟机监控程序。

使用虚拟机
----------
对个人用户而言，平时使用最多的是Type-2类虚拟机监控程序包括VirtualBox（开源）、Virt-manager
（开源，管理KVM虚拟机和LXC容器）和VMware（商用，可通过搜索序列号使用）。

使用虚拟机监控程序创建虚拟机时要分配的硬件资源如CPU核数、内存大小（不要超过提示的最大值）、磁盘
空间和网络模式（一般使用NAT模式，其他还有桥接等）进行配置以满足使用需求。为了方便虚拟机使用还可
以安装扩展功能插件如vmware-tools等。读者可根据自己选择的虚拟机监控程序在浏览器搜索对应的安装教
程创建虚拟机。

.. 容器
.. ======

.. 容器是相较于虚拟机的一种更为轻量的虚拟化技术，在深入了解容器前先看看容器与虚拟机的对比，如图所示：


参考文件及扩展阅读
==================
Hypervisor是什么？：https://www.redhat.com/zh/topics/virtualization/what-is-a-hypervisor

